sequenceDiagram
    participant Client as Client/Device
    participant LB as Load Balancer
    participant Gateway as API Gateway
    participant Auth as Auth Service
    participant Cache as Redis Cache

    Client->>+LB: POST /api/v1/auth/logout
    Note over Client,LB: Authorization: Bearer {access_token}
    
    LB->>+Gateway: Forward request
    Gateway->>Gateway: Extract JWT token
    Gateway->>Gateway: Validate token signature
    Gateway->>Gateway: Extract user_id & company_id
    
    Gateway->>+Auth: POST /api/v1/auth/logout
    Note over Gateway,Auth: Validated token context
    
    Auth->>Auth: Extract token info
    Note over Auth: user_id, device_id, jti (JWT ID)
    
    par Invalidate access token
        Auth->>+Cache: Add token to blacklist
        Note over Auth,Cache: Key: blacklist_token:{jti}<br/>TTL: remaining token lifetime
        Cache-->>-Auth: Token blacklisted
    and Remove refresh token
        Auth->>+Cache: DELETE refresh_token:{user_id}:{device_id}
        Cache-->>-Auth: Refresh token removed
    and Clear user session
        Auth->>+Cache: DELETE user_session:{user_id}:{device_id}
        Cache-->>-Auth: Session cleared
    end
    
    Auth-->>-Gateway: 200 OK - Logout successful
    Gateway-->>-LB: Success response
    LB-->>-Client: Logout confirmed
    