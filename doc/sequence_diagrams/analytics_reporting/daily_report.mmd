sequenceDiagram
    participant Admin as Company Admin
    participant LB as Load Balancer
    participant Gateway as API Gateway
    participant Auth as Auth Service
    participant Analytics as Analytics Service
    participant TimeSeries as ScyllaDB
    participant Cache as Redis Cache
    participant DB as PostgreSQL
    participant Workforce as Workforce Service

    Admin->>+LB: GET /api/v1/reports/daily?date=2024-01-15&location_id=123
    Note over Admin,LB: Authorization: Bearer {admin_token}
    
    LB->>+Gateway: Forward request
    Gateway->>+Auth: Validate token & extract company_id
    Auth-->>-Gateway: Company authorized
    
    Gateway->>+Analytics: GET /api/v1/reports/daily
    Note over Gateway,Analytics: {company_id, date, location_id, filters}
    
    Analytics->>+Cache: GET daily_report:{company_id}:{date}:{location_id}
    Cache-->>-Analytics: Cached report or miss
    
    alt Cache hit - return cached report
        Analytics-->>Gateway: Cached daily report
    else Cache miss - generate report
        par Fetch attendance records
            Analytics->>+TimeSeries: Query attendance records for date
            Note over Analytics,TimeSeries: SELECT * FROM attendance<br/>WHERE company_id AND date AND location_id
            TimeSeries-->>-Analytics: Raw attendance data
        and Fetch employee schedules
            Analytics->>+Workforce: Get scheduled employees for date
            Note over Analytics,Workforce: Expected vs actual attendance
            Workforce-->>-Analytics: Schedule data
        and Get employee details
            Analytics->>+DB: Get employee information
            Note over Analytics,DB: JOIN with departments, positions
            DB-->>-Analytics: Employee details
        end
        
        Analytics->>Analytics: Process and aggregate data
        Note over Analytics: Calculate:
        Note over Analytics: - Total check-ins/outs
        Note over Analytics: - Late arrivals
        Note over Analytics: - Early departures  
        Note over Analytics: - Missing attendances
        Note over Analytics: - Work hour summaries
        
        par Generate detailed report
            Analytics->>Analytics: Build comprehensive report
            Note over Analytics: Include charts, summaries, exceptions
        and Cache the report
            Analytics->>+Cache: Cache daily report
            Note over Analytics,Cache: TTL: 6 hours (updates during day)
            Cache-->>-Analytics: Report cached
        and Update aggregated metrics
            Analytics->>+DB: Update daily summary tables
            Note over Analytics,DB: For monthly/yearly reporting
            DB-->>-Analytics: Metrics updated
        end
        
        Analytics-->>-Gateway: Generated daily report
    end
    
    Gateway-->>-LB: Report response
    LB-->>-Admin: Daily attendance report
    