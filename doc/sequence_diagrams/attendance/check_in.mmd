sequenceDiagram
    autonumber
    participant Staff as Employee
    participant Device as Attendance Device
    box AI Processing Engine #e6f7ff
        participant Gateway as API Gateway
        participant AI as Face Matching AI
        participant Core as Attendance Core
    end
    participant Socket as WebSocket Server

    Staff->>Device: Look at Camera
    Device->>Device: Liveness Check (On-Device)
    Note right of Device: Anti-spoofing detection
    
    Device->>+Gateway: POST /check-in (Face Image + Device ID)
    Gateway->>Gateway: Validate Device Token
    
    Gateway->>+AI: Identify Face
    Note right of AI: Real-time Face Recognition Pipeline
    
    AI->>AI: Extract Face Embedding (512-d Vector)
    AI->>AI: Vector Matching (1:N Search)
    Note right of AI: Compare with Company Face DB<br/>Similarity Threshold > 0.85
    
    alt No Match Found
        AI-->>Gateway: 404 Not Found
        Gateway-->>Device: "Person Not Recognized"
        Device-->>Staff: Show Error Message
    else Match Found
        AI-->>-Core: Match Result (User ID, Confidence: 0.92)
        
        Core->>Core: Validate Business Rules
        Note right of Core: Check shift schedule<br/>Prevent duplicate check-in (1 min)
        
        Core->>Core: Record Time Log
        Note right of Core: Store in Time-Series DB<br/>Partition by Date + Company
        
        par Real-time Sync
            Core->>Socket: Push Notification to Admin Dashboard
            Note right of Socket: Show live attendance updates
        and Response
            Core-->>-Gateway: 200 OK
            Gateway-->>-Device: Check-in Success
        end
        
        Device-->>Staff: Display "Welcome, [Name]!"
    end
    Note over Device,TimeSeries: 1. Face vector clustering by company
    Note over Device,TimeSeries: 2. Distributed face matching across nodes
    Note over Device,TimeSeries: 3. Time-series partitioning for attendance records
    Note over Device,TimeSeries: 4. Real-time caching of active employees
    Note over Device,TimeSeries: 5. GPU-accelerated face verification