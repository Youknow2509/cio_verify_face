sequenceDiagram
    autonumber
    participant Device as Attendance Device
    participant Gateway as WebSocket Gateway
    box Real-time Messaging #f0f9ff
        participant Socket as WebSocket Service
        participant Queue as Event Queue
    end
    participant Core as Attendance Core

    Note over Device,Core: Real-time Attendance Result Notification

    Device->>+Gateway: Connect WebSocket
    Note right of Device: ws://api.domain/ws?device={id}&token={jwt}
    
    Gateway->>Gateway: Validate Device Token
    Gateway->>+Socket: Register Connection
    Note right of Socket: Map Device ID → Socket Connection
    Socket-->>-Gateway: Connected
    Gateway-->>-Device: Connection Established

    Note over Device,Core: ─── Attendance Check-in Occurs ───

    Core->>+Queue: Publish "AttendanceResult" Event
    Note right of Queue: Payload: {device_id, user, result, timestamp}
    
    Queue->>+Socket: Deliver Event to Device
    
    alt Device Online
        Socket->>+Gateway: Send Message to Device
        Gateway->>Device: Push Notification
        Note right of Device: Display Result:<br/>"✓ Welcome John Doe - 08:30 AM"
        Device->>Gateway: ACK Received
        Gateway-->>-Socket: Delivery Confirmed
    else Device Offline
        Socket->>Socket: Queue Message (TTL: 5 min)
        Note right of Socket: Deliver when device reconnects
    end
    
    Socket-->>-Queue: Event Processed

    Note over Device,Socket: ─── Heartbeat Monitoring ───

    loop Every 30 seconds
        Device->>Gateway: Ping
        Gateway->>Device: Pong
    end