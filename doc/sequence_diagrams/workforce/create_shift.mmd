sequenceDiagram
    autonumber
    participant Manager as HR Manager
    participant Gateway as API Gateway
    box Workforce Management #f9fbe7
        participant Auth as Auth Service
        participant Workforce as Workforce Service
    end
    participant Data as Data Layer

    Manager->>+Gateway: POST /shifts (Shift Details)
    Note right of Manager: Payload: {name, start_time, end_time,<br/>break_duration, days_of_week}
    
    Gateway->>+Auth: Validate Manager Token
    Auth->>Auth: Check Role Permissions
    Note right of Auth: Verify "Create Shift" permission
    Auth-->>-Gateway: Authorized
    
    Gateway->>+Workforce: Create Shift Request
    
    Workforce->>Workforce: Validate Shift Data
    Note right of Workforce: • Time range validation<br/>• Break duration limits<br/>• Days of week format
    
    Workforce->>+Data: Check for Conflicting Shifts
    Note right of Data: Query overlapping time ranges<br/>for same employees
    
    alt Conflicts Found
        Data-->>Workforce: Conflict Detected
        Workforce-->>Gateway: 409 Conflict
        Gateway-->>Manager: Error: Overlapping Shifts
    else No Conflicts
        Data-->>-Workforce: Clear to Create
        
        Workforce->>+Data: Create Shift Record
        Data-->>-Workforce: Shift Created (ID: 12345)
        
        par Post-Creation
            Workforce->>Data: Cache Shift Info (24h TTL)
        and Notify
            Workforce->>Data: Publish "ShiftCreated" Event
            Note right of Data: Trigger schedule updates<br/>& employee notifications
        end
        
        Workforce-->>-Gateway: 201 Created
        Gateway-->>-Manager: Shift Created Successfully
    end