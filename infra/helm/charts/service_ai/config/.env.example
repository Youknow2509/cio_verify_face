# Example configuration for service-ai chart. Copy to .env and update values before deploying.
ENVIRONMENT=development
SERVICE_NAME=service_ai
SERVICE_ID=service_ai_local
SERVICE_WORKERS=4
SERVICE_HOST=0.0.0.0
SERVICE_PORT=8080
GRPC_PORT=50051
COMPUTE_MODE=cpu

# Observability
OBSERVABILITY_ENABLED=true
METRICS_PORT=9090
METRICS_PATH=/metrics
TRACING_ENABLED=true
OTLP_ENDPOINT=http://jaeger.cio-verify-face-dev.svc.cluster.local:4318/v1/traces

# GRPC Client
GRPC_CLIENT_KEEPALIVE_TIME_MS=120000
GRPC_CLIENT_KEEPALIVE_TIMEOUT_MS=20000
GRPC_CLIENT_KEEPALIVE_PERMIT_WITHOUT_CALLS=0
GRPC_CLIENT_HTTP2_MAX_PINGS_WITHOUT_DATA=1
GRPC_CLIENT_HTTP2_MIN_TIME_BETWEEN_PINGS_MS=60000
GRPC_CLIENT_HTTP2_MIN_PING_INTERVAL_WITHOUT_DATA_MS=60000

# GRPC Server
GRPC_SERVER_KEEPALIVE_TIME_MS=120000
GRPC_SERVER_KEEPALIVE_TIMEOUT_MS=20000
GRPC_SERVER_HTTP2_MIN_TIME_BETWEEN_PINGS_MS=60000
GRPC_SERVER_KEEPALIVE_PERMIT_WITHOUT_CALLS=1

# GRPC Auth Client
GRPC_AUTH_URL=service-auth.cio-verify-face-dev.svc.cluster.local:50051
GRPC_AUTH_TLS=false
GRPC_AUTH_CERT_PATH=
GRPC_AUTH_KEY_PATH=

# GRPC Attendance Client
GRPC_ATTENDANCE_URL=service-attendance.cio-verify-face-dev.svc.cluster.local:50051
GRPC_ATTENDANCE_TLS=false
GRPC_ATTENDANCE_CERT_PATH=
GRPC_ATTENDANCE_KEY_PATH=

# Attendance batching
ATTENDANCE_BATCH_MAX_SIZE=10
ATTENDANCE_BATCH_FLUSH_INTERVAL=3.0
ATTENDANCE_BATCH_MAX_PENDING=100

# Database
DATABASE_URL=postgresql://postgres:change-me@env-main-database.cio-verify-face-dev.svc.cluster.local:5432/cio_verify_face

# Redis
REDIS_TYPE=1
REDIS_USE_TLS=false
REDIS_CERT_PATH=./config/redis/cert.pem
REDIS_KEY_PATH=./config/redis/key.pem
REDIS_PASSWORD=change-me
REDIS_DB=0
# Standalone
REDIS_HOST=env-distributed-cache-master.cio-verify-face-dev.svc.cluster.local
REDIS_PORT=6379
# Sentinel
REDIS_MASTER_NAME=mymaster
REDIS_SENTINEL_ADDRS=["env-distributed-cache-master.cio-verify-face-dev.svc.cluster.local:26379"]
# Cluster
REDIS_CLUSTER_ADDRS=["env-distributed-cache-master.cio-verify-face-dev.svc.cluster.local:6379"]
REDIS_ROUTE_BY_LATENCY=true
REDIS_ROUTE_RANDOMLY=false
# Redis Pool
REDIS_POOL_SIZE=10
REDIS_MIN_IDLE_CONNS=2
REDIS_MAX_RETRIES=3

# ScyllaDB
SCYLLADB_HOSTS=env-cql-database.cio-verify-face-dev.svc.cluster.local
SCYLLADB_PORT=9042
SCYLLADB_KEYSPACE=cio_verify_face
SCYLLADB_USERNAME=cassandra
SCYLLADB_PASSWORD=change-me

# MinIO
MINIO_ENDPOINT=env-object-storage.cio-verify-face-dev.svc.cluster.local:9000
MINIO_ACCESS_KEY=minio
MINIO_SECRET_KEY=change-me
MINIO_SECURE=false
MINIO_BUCKET_FACES=face-images
MINIO_BUCKET_VERIFICATIONS=verification-images

# Image Settings
IMAGE_MAX_SIZE=1920
IMAGE_QUALITY=85
IMAGE_STORE_ENROLLMENTS=true
IMAGE_STORE_VERIFICATIONS=false
IMAGE_STORE_FAILED_VERIFICATIONS=false

# Model
FACE_DETECTOR_MODEL=retinaface_r50_v1
FACE_EMBEDDING_MODEL=arcface_r100_v1
EMBEDDING_DIMENSION=512

# Thresholds
QUALITY_THRESHOLD=0.5
DUPLICATE_THRESHOLD=0.95
DUPLICATE_GAP_THRESHOLD=0.12
VERIFY_THRESHOLD=0.60
MIN_FACE_SIZE=80

# Vector search (pgvector)
VECTOR_INDEX_REBUILD_INTERVAL=3600
VECTOR_DB_INDEX_VERSION=1

# Milvus
MILVUS_URI=http://milvus:19530
MILVUS_TOKEN=
MILVUS_HOST=milvus
MILVUS_PORT=19530
MILVUS_SECURE=false
MILVUS_USERNAME=
MILVUS_PASSWORD=
MILVUS_DB=default
MILVUS_COLLECTION=face_profiles
MILVUS_INDEX_TYPE=FLAT
MILVUS_METRIC_TYPE=IP
MILVUS_NLIST=1024
MILVUS_NPROBE=16

# Liveness
LIVENESS_ENABLED=true
LIVENESS_THRESHOLD=0.7

# Security
ENCRYPTION_KEY=change-me
JWT_SECRET=change-me

# Logging
LOG_LEVEL=INFO
LOG_FORMAT=json
LOG_FILEPATH=./service_ai.log

# Storage
STORAGE_PATH=/app/data
MODEL_PATH=/app/data/models
INDEX_PATH=/app/data/indexes

# Performance
MAX_WORKERS=2
BATCH_SIZE=32

# Retention
SOFT_DELETE_RETENTION=30

# FAISS
FAISS_INDEX_TYPE=IVF
FAISS_REBUILD_INTERVAL=3600
