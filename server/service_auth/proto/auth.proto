syntax = "proto3";

package auth;

option go_package = "github.com/youknow2509/cio_verify_face/server/service_auth/proto/pb";

// Auth service for inter-service communication
service AuthService {
  // Validate access token
  rpc ValidateToken(ValidateTokenRequest) returns (ValidateTokenResponse);
  
  // Get user information
  rpc GetUserInfo(GetUserInfoRequest) returns (GetUserInfoResponse);
  
  // Check user permission in company
  rpc CheckUserPermission(CheckUserPermissionRequest) returns (CheckUserPermissionResponse);
  
  // Check if device belongs to company
  rpc CheckDeviceInCompany(CheckDeviceInCompanyRequest) returns (CheckDeviceInCompanyResponse);
  
  // Validate device session
  rpc ValidateDeviceSession(ValidateDeviceSessionRequest) returns (ValidateDeviceSessionResponse);
  
  // Get company information by user
  rpc GetUserCompany(GetUserCompanyRequest) returns (GetUserCompanyResponse);
  
  // Batch validate multiple tokens
  rpc BatchValidateTokens(BatchValidateTokensRequest) returns (BatchValidateTokensResponse);
}

// Messages for ValidateToken
message ValidateTokenRequest {
  string token = 1;
  optional string required_permission = 2;
  optional string company_id = 3;
}

message ValidateTokenResponse {
  bool valid = 1;
  string user_id = 2;
  string company_id = 3;
  string session_id = 4;
  string error_message = 5;
  int64 expires_at = 6;
  repeated string permissions = 7;
}

// Messages for GetUserInfo
message GetUserInfoRequest {
  string user_id = 1;
}

message GetUserInfoResponse {
  string user_id = 1;
  string email = 2;
  string first_name = 3;
  string last_name = 4;
  string company_id = 5;
  string role = 6;
  bool is_active = 7;
  int64 created_at = 8;
  int64 updated_at = 9;
  string error_message = 10;
}

// Messages for CheckUserPermission
message CheckUserPermissionRequest {
  string user_id = 1;
  string company_id = 2;
  optional string required_permission = 3;
}

message CheckUserPermissionResponse {
  bool has_permission = 1;
  string user_role = 2;
  repeated string permissions = 3;
  string error_message = 4;
}

// Messages for CheckDeviceInCompany
message CheckDeviceInCompanyRequest {
  string device_id = 1;
  string company_id = 2;
}

message CheckDeviceInCompanyResponse {
  bool device_exists = 1;
  bool is_active = 2;
  string device_name = 3;
  string device_type = 4;
  string error_message = 5;
}

// Messages for ValidateDeviceSession
message ValidateDeviceSessionRequest {
  string device_id = 1;
  string session_token = 2;
  string company_id = 3;
}

message ValidateDeviceSessionResponse {
  bool valid = 1;
  string device_id = 2;
  string company_id = 3;
  string user_id = 4;
  int64 expires_at = 5;
  string error_message = 6;
}

// Messages for GetUserCompany
message GetUserCompanyRequest {
  string user_id = 1;
}

message GetUserCompanyResponse {
  string company_id = 1;
  string company_name = 2;
  string company_code = 3;
  bool is_active = 4;
  string user_role = 5;
  repeated string permissions = 6;
  string error_message = 7;
}

// Messages for BatchValidateTokens
message TokenValidation {
  string token = 1;
  string request_id = 2; // To match request with response
}

message BatchValidateTokensRequest {
  repeated TokenValidation tokens = 1;
  optional string required_permission = 2;
  optional string company_id = 3;
}

message TokenValidationResult {
  string request_id = 1;
  bool valid = 2;
  string user_id = 3;
  string company_id = 4;
  string session_id = 5;
  string error_message = 6;
  int64 expires_at = 7;
  repeated string permissions = 8;
}

message BatchValidateTokensResponse {
  repeated TokenValidationResult results = 1;
}