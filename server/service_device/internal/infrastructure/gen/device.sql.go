// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.27.0
// source: device.sql

package database

import (
	"context"
	"net/netip"

	"github.com/jackc/pgx/v5/pgtype"
)

const checkDeviceExist = `-- name: CheckDeviceExist :one
SELECT device_id
FROM devices
WHERE device_id = $1
LIMIT 1
`

func (q *Queries) CheckDeviceExist(ctx context.Context, deviceID pgtype.UUID) (pgtype.UUID, error) {
	row := q.db.QueryRow(ctx, checkDeviceExist, deviceID)
	var device_id pgtype.UUID
	err := row.Scan(&device_id)
	return device_id, err
}

const createNewDevice = `-- name: CreateNewDevice :exec
INSERT INTO devices (
    device_id,
    company_id ,
    name,
    address,
    serial_number,
    mac_address,
    token,
    created_at,
    updated_at
) VALUES (
    $1, $2, $3, $4, $5, $6, $7, NOW(), NOW()
)
`

type CreateNewDeviceParams struct {
	DeviceID     pgtype.UUID
	CompanyID    pgtype.UUID
	Name         string
	Address      pgtype.Text
	SerialNumber pgtype.Text
	MacAddress   pgtype.Text
	Token        string
}

func (q *Queries) CreateNewDevice(ctx context.Context, arg CreateNewDeviceParams) error {
	_, err := q.db.Exec(ctx, createNewDevice,
		arg.DeviceID,
		arg.CompanyID,
		arg.Name,
		arg.Address,
		arg.SerialNumber,
		arg.MacAddress,
		arg.Token,
	)
	return err
}

const deleteDevice = `-- name: DeleteDevice :exec
DELETE FROM devices
WHERE device_id = $1
`

func (q *Queries) DeleteDevice(ctx context.Context, deviceID pgtype.UUID) error {
	_, err := q.db.Exec(ctx, deleteDevice, deviceID)
	return err
}

const disableDevice = `-- name: DisableDevice :exec
UPDATE devices
SET status = 0, updated_at = NOW()
WHERE device_id = $1
`

func (q *Queries) DisableDevice(ctx context.Context, deviceID pgtype.UUID) error {
	_, err := q.db.Exec(ctx, disableDevice, deviceID)
	return err
}

const enableDevice = `-- name: EnableDevice :exec
UPDATE devices
SET status = 1, updated_at = NOW()
WHERE device_id = $1
`

func (q *Queries) EnableDevice(ctx context.Context, deviceID pgtype.UUID) error {
	_, err := q.db.Exec(ctx, enableDevice, deviceID)
	return err
}

const getDeviceInfo = `-- name: GetDeviceInfo :one
SELECT
    company_id,
    name,
    address,
    serial_number,
    mac_address,
    ip_address,
    firmware_version,
    last_heartbeat,
    token,
    settings,
    created_at,
    updated_at
FROM devices
WHERE device_id = $1
LIMIT 1
`

type GetDeviceInfoRow struct {
	CompanyID       pgtype.UUID
	Name            string
	Address         pgtype.Text
	SerialNumber    pgtype.Text
	MacAddress      pgtype.Text
	IpAddress       *netip.Addr
	FirmwareVersion pgtype.Text
	LastHeartbeat   pgtype.Timestamptz
	Token           string
	Settings        []byte
	CreatedAt       pgtype.Timestamptz
	UpdatedAt       pgtype.Timestamptz
}

func (q *Queries) GetDeviceInfo(ctx context.Context, deviceID pgtype.UUID) (GetDeviceInfoRow, error) {
	row := q.db.QueryRow(ctx, getDeviceInfo, deviceID)
	var i GetDeviceInfoRow
	err := row.Scan(
		&i.CompanyID,
		&i.Name,
		&i.Address,
		&i.SerialNumber,
		&i.MacAddress,
		&i.IpAddress,
		&i.FirmwareVersion,
		&i.LastHeartbeat,
		&i.Token,
		&i.Settings,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getDeviceInfoBase = `-- name: GetDeviceInfoBase :one
SELECT
    company_id,
    name,
    address,
    serial_number,
    mac_address,
    status,
    token,
    created_at,
    updated_at
FROM devices
WHERE device_id = $1
LIMIT 1
`

type GetDeviceInfoBaseRow struct {
	CompanyID    pgtype.UUID
	Name         string
	Address      pgtype.Text
	SerialNumber pgtype.Text
	MacAddress   pgtype.Text
	Status       pgtype.Int2
	Token        string
	CreatedAt    pgtype.Timestamptz
	UpdatedAt    pgtype.Timestamptz
}

func (q *Queries) GetDeviceInfoBase(ctx context.Context, deviceID pgtype.UUID) (GetDeviceInfoBaseRow, error) {
	row := q.db.QueryRow(ctx, getDeviceInfoBase, deviceID)
	var i GetDeviceInfoBaseRow
	err := row.Scan(
		&i.CompanyID,
		&i.Name,
		&i.Address,
		&i.SerialNumber,
		&i.MacAddress,
		&i.Status,
		&i.Token,
		&i.CreatedAt,
		&i.UpdatedAt,
	)
	return i, err
}

const getDeviceToken = `-- name: GetDeviceToken :one
SELECT token
FROM devices
WHERE device_id = $1
LIMIT 1
`

func (q *Queries) GetDeviceToken(ctx context.Context, deviceID pgtype.UUID) (string, error) {
	row := q.db.QueryRow(ctx, getDeviceToken, deviceID)
	var token string
	err := row.Scan(&token)
	return token, err
}

const getListDeviceInCompany = `-- name: GetListDeviceInCompany :many
SELECT
    device_id,
    company_id,
    name,
    address,
    serial_number,
    mac_address,
    status,
    token,
    created_at,
    updated_at
FROM devices
WHERE company_id = $1
LIMIT $2 OFFSET $3
`

type GetListDeviceInCompanyParams struct {
	CompanyID pgtype.UUID
	Limit     int32
	Offset    int32
}

type GetListDeviceInCompanyRow struct {
	DeviceID     pgtype.UUID
	CompanyID    pgtype.UUID
	Name         string
	Address      pgtype.Text
	SerialNumber pgtype.Text
	MacAddress   pgtype.Text
	Status       pgtype.Int2
	Token        string
	CreatedAt    pgtype.Timestamptz
	UpdatedAt    pgtype.Timestamptz
}

func (q *Queries) GetListDeviceInCompany(ctx context.Context, arg GetListDeviceInCompanyParams) ([]GetListDeviceInCompanyRow, error) {
	rows, err := q.db.Query(ctx, getListDeviceInCompany, arg.CompanyID, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	var items []GetListDeviceInCompanyRow
	for rows.Next() {
		var i GetListDeviceInCompanyRow
		if err := rows.Scan(
			&i.DeviceID,
			&i.CompanyID,
			&i.Name,
			&i.Address,
			&i.SerialNumber,
			&i.MacAddress,
			&i.Status,
			&i.Token,
			&i.CreatedAt,
			&i.UpdatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const updateDeviceInfo = `-- name: UpdateDeviceInfo :exec
UPDATE devices
SET serial_number = $2,
    mac_address = $3,
    firmware_version = $4,
    updated_at = NOW()
WHERE device_id = $1
`

type UpdateDeviceInfoParams struct {
	DeviceID        pgtype.UUID
	SerialNumber    pgtype.Text
	MacAddress      pgtype.Text
	FirmwareVersion pgtype.Text
}

func (q *Queries) UpdateDeviceInfo(ctx context.Context, arg UpdateDeviceInfoParams) error {
	_, err := q.db.Exec(ctx, updateDeviceInfo,
		arg.DeviceID,
		arg.SerialNumber,
		arg.MacAddress,
		arg.FirmwareVersion,
	)
	return err
}

const updateDeviceLocation = `-- name: UpdateDeviceLocation :exec
UPDATE devices
SET location_id = $2, address = $3, updated_at = NOW()
WHERE device_id = $1
`

type UpdateDeviceLocationParams struct {
	DeviceID   pgtype.UUID
	LocationID pgtype.UUID
	Address    pgtype.Text
}

func (q *Queries) UpdateDeviceLocation(ctx context.Context, arg UpdateDeviceLocationParams) error {
	_, err := q.db.Exec(ctx, updateDeviceLocation, arg.DeviceID, arg.LocationID, arg.Address)
	return err
}

const updateDeviceName = `-- name: UpdateDeviceName :exec
UPDATE devices
SET name = $2, updated_at = NOW()
WHERE device_id = $1
`

type UpdateDeviceNameParams struct {
	DeviceID pgtype.UUID
	Name     string
}

func (q *Queries) UpdateDeviceName(ctx context.Context, arg UpdateDeviceNameParams) error {
	_, err := q.db.Exec(ctx, updateDeviceName, arg.DeviceID, arg.Name)
	return err
}
